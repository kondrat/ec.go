/*
 * jQuery Templating Plugin
 * Copyright 2010, John Resig
 * Dual licensed under the MIT or GPL Version 2 licenses.
 */
(function(n,o){var p=n.fn.domManip,tmplItmAtt="_tmplitem",htmlExpr=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,newTmplItems={},wrappedItems={},appendToTmplItems,topTmplItem={key:0,data:{}},itemKey=0,cloneIndex=0,stack=[];function newTmplItem(a,b,c,d){var e={data:d||(b?b.data:{}),_wrap:b?b._wrap:null,tmpl:null,parent:b||null,nodes:[],calls:tiCalls,nest:tiNest,wrap:tiWrap,html:tiHtml,update:tiUpdate};if(a){n.extend(e,a,{nodes:[],parent:b})}if(c){e.tmpl=c;e._ctnt=e._ctnt||e.tmpl(n,e);e.key=++itemKey;(stack.length?wrappedItems:newTmplItems)[itemKey]=e}return e}n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(c,d){n.fn[c]=function(a){var b=[],insert=n(a),elems,i,l,tmplItems,parent=this.length===1&&this[0].parentNode;appendToTmplItems=newTmplItems||{};if(parent&&parent.nodeType===11&&parent.childNodes.length===1&&insert.length===1){insert[d](this[0]);b=this}else{for(i=0,l=insert.length;i<l;i++){cloneIndex=i;elems=(i>0?this.clone(true):this).get();n.fn[d].apply(n(insert[i]),elems);b=b.concat(elems)}cloneIndex=0;b=this.pushStack(b,c,insert.selector)}tmplItems=appendToTmplItems;appendToTmplItems=null;n.tmpl.complete(tmplItems);return b}});n.fn.extend({tmpl:function(a,b,c){return n.tmpl(this[0],a,b,c)},tmplItem:function(){return n.tmplItem(this[0])},template:function(a){return n.template(a,this[0])},domManip:function(b,c,d,e){if(b[0]&&b[0].nodeType){var f=n.makeArray(arguments),argsLength=b.length,i=0,tmplItem;while(i<argsLength&&!(tmplItem=n.data(b[i++],"tmplItem"))){}if(argsLength>1){f[0]=[n.makeArray(b)]}if(tmplItem&&cloneIndex){f[2]=function(a){n.tmpl.afterManip(this,a,d)}}p.apply(this,f)}else{p.apply(this,arguments)}cloneIndex=0;if(!appendToTmplItems){n.tmpl.complete(newTmplItems)}return this}});n.extend({tmpl:function(b,c,d,e){var f,topLevel=!e;if(topLevel){e=topTmplItem;b=n.template[b]||n.template(null,b);wrappedItems={}}else if(!b){b=e.tmpl;newTmplItems[e.key]=e;e.nodes=[];if(e.wrapped){updateWrapped(e,e.wrapped)}return n(build(e,null,e.tmpl(n,e)))}if(!b){return[]}if(typeof c==="function"){c=c.call(e||{})}if(d&&d.wrapped){updateWrapped(d,d.wrapped)}f=n.isArray(c)?n.map(c,function(a){return a?newTmplItem(d,e,b,a):null}):[newTmplItem(d,e,b,c)];return topLevel?n(build(e,null,f)):f},tmplItem:function(a){var b;if(a instanceof n){a=a[0]}while(a&&a.nodeType===1&&!(b=n.data(a,"tmplItem"))&&(a=a.parentNode)){}return b||topTmplItem},template:function(a,b){if(b){if(typeof b==="string"){b=buildTmplFn(b)}else if(b instanceof n){b=b[0]||{}}if(b.nodeType){b=n.data(b,"tmpl")||n.data(b,"tmpl",buildTmplFn(b.innerHTML))}return typeof a==="string"?(n.template[a]=b):b}return a?(typeof a!=="string"?n.template(null,a):(n.template[a]||n.template(null,htmlExpr.test(a)?a:n(a)))):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});n.extend(n.tmpl,{tag:{"tmpl":{_default:{$2:"null"},open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},"wrap":{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},"each":{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},"html":{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},"!":{open:""}},complete:function(a){newTmplItems={}},afterManip:function afterManip(a,b,c){var d=b.nodeType===11?n.makeArray(b.childNodes):b.nodeType===1?[b]:[];c.call(a,b);storeTmplItems(d);cloneIndex++}});function build(e,f,g){var h,ret=g?n.map(g,function(a){return(typeof a==="string")?(e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+tmplItmAtt+"=\""+e.key+"\" $2"):a):build(a,e,a._ctnt)}):e;if(f){return ret}ret=ret.join("");ret.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(a,b,c,d){h=n(c).get();storeTmplItems(h);if(b){h=unencode(b).concat(h)}if(d){h=h.concat(unencode(d))}});return h?h:unencode(ret)}function unencode(a){var b=document.createElement("div");b.innerHTML=a;return n.makeArray(b.childNodes)}function buildTmplFn(m){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;"+"with($data){_.push('"+n.trim(m).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(e,f,g,h,i,j,k){var l=n.tmpl.tag[g],def,expr,exprAutoFnDetect;if(!l){throw"Template command not found: "+g;}def=l._default||[];if(j&&!/\w$/.test(i)){i+=j;j=""}if(i){i=unescape(i);k=k?(","+unescape(k)+")"):(j?")":"");expr=j?(i.indexOf(".")>-1?i+j:("("+i+").call($item"+k)):i;exprAutoFnDetect=j?expr:"(typeof("+i+")==='function'?("+i+").call($item):("+i+"))"}else{exprAutoFnDetect=expr=def.$1||"null"}h=unescape(h);return"');"+l[f?"close":"open"].split("$notnull_1").join(i?"typeof("+i+")!=='undefined' && ("+i+")!=null":"true").split("$1a").join(exprAutoFnDetect).split("$1").join(expr).split("$2").join(h?h.replace(/\s*([^\(]+)\s*(\((.*?)\))?/g,function(a,b,c,d){d=d?(","+d+")"):(c?")":"");return d?("("+b+").call($item"+d):a}):(def.$2||""))+"_.push('"})+"');}return _;")}function updateWrapped(a,b){a._wrap=build(a,true,n.isArray(b)?b:[htmlExpr.test(b)?b:n(b).html()]).join("")}function unescape(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function outerHtml(a){var b=document.createElement("div");b.appendChild(a.cloneNode(true));return b.innerHTML}function storeTmplItems(d){var e="_"+cloneIndex,elem,elems,newClonedItems={},i,l,m;for(i=0,l=d.length;i<l;i++){if((elem=d[i]).nodeType!==1){continue}elems=elem.getElementsByTagName("*");for(m=elems.length-1;m>=0;m--){processItemKey(elems[m])}processItemKey(elem)}function processItemKey(b){var c,pntNode=b,pntItem,tmplItem,key;if((key=b.getAttribute(tmplItmAtt))){while(pntNode.parentNode&&(pntNode=pntNode.parentNode).nodeType===1&&!(c=pntNode.getAttribute(tmplItmAtt))){}if(c!==key){pntNode=pntNode.parentNode?(pntNode.nodeType===11?0:(pntNode.getAttribute(tmplItmAtt)||0)):0;if(!(tmplItem=newTmplItems[key])){tmplItem=wrappedItems[key];tmplItem=newTmplItem(tmplItem,newTmplItems[pntNode]||wrappedItems[pntNode],null,true);tmplItem.key=++itemKey;newTmplItems[itemKey]=tmplItem}if(cloneIndex){cloneTmplItem(key)}}b.removeAttribute(tmplItmAtt)}else if(cloneIndex&&(tmplItem=n.data(b,"tmplItem"))){cloneTmplItem(tmplItem.key);newTmplItems[tmplItem.key]=tmplItem;pntNode=n.data(b.parentNode,"tmplItem");pntNode=pntNode?pntNode.key:0}if(tmplItem){pntItem=tmplItem;while(pntItem&&pntItem.key!=pntNode){pntItem.nodes.push(b);pntItem=pntItem.parent}delete tmplItem._ctnt;delete tmplItem._wrap;n.data(b,"tmplItem",tmplItem)}function cloneTmplItem(a){a=a+e;tmplItem=newClonedItems[a]=(newClonedItems[a]||newTmplItem(tmplItem,newTmplItems[tmplItem.parent.key+e]||tmplItem.parent,null,true))}}}function tiCalls(a,b,c,d){if(!a){return stack.pop()}stack.push({_:a,tmpl:b,item:this,data:c,options:d})}function tiNest(a,b,c){return n.tmpl(n.template(a),b,c,this)}function tiWrap(a,b){var c=a.options||{};c.wrapped=b;return n.tmpl(n.template(a.tmpl),a.data,c,a.item)}function tiHtml(a,b){var c=this._wrap;return n.map(n(n.isArray(c)?c.join(""):c).filter(a||"*"),function(e){return b?e.innerText||e.textContent:e.outerHTML||outerHtml(e)})}function tiUpdate(){var a=this.nodes;n.tmpl(null,null,null,this).insertBefore(a[0]);n(a).remove()}})(jQuery);
